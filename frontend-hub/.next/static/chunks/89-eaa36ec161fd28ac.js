"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[89],{89:function(e,t,r){r.d(t,{E:function(){return x}});var n=r(7437),a=r(2265),s=r(740),o=r(3247),i=r(1239),c=r(2489),l=r(1723),u=r(8614),g=r(521),h=r(279),d=r(2381),m=r(9174);let f="hub-search-history";class p{static async search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n="search:".concat(e,":").concat(JSON.stringify(t),":").concat(JSON.stringify(r)),a=this.cache.get(n);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;try{let a=new URLSearchParams({q:e,page:String(r.page||1),limit:String(r.limit||12),sort:r.sort||"relevance",...t}),s=await fetch("".concat(this.baseUrl,"/api/hub/search?").concat(a));if(!s.ok)throw Error("Erreur recherche: ".concat(s.status));let o=await s.json();return this.cache.set(n,{data:o,timestamp:Date.now()}),o}catch(e){return console.error("Erreur lors de la recherche:",e),{associations:[],campaigns:[],total:0}}}static async getAutocompleteSuggestions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e.trim())return{suggestions:[],recent:t.slice(0,5)};let r="autocomplete:".concat(e),n=this.cache.get(r);if(n&&Date.now()-n.timestamp<this.CACHE_DURATION)return{...n.data,recent:t.slice(0,5)};try{let n=new URLSearchParams({q:e,limit:"8"}),a=await fetch("".concat(this.baseUrl,"/api/hub/autocomplete?").concat(n));if(!a.ok)throw Error("Erreur autocompl\xe9tion: ".concat(a.status));let s={suggestions:(await a.json()).slice(0,6),recent:t.slice(0,5)};return this.cache.set(r,{data:{suggestions:s.suggestions,recent:[]},timestamp:Date.now()}),s}catch(e){return console.error("Erreur lors de l'autocompl\xe9tion:",e),{suggestions:[],recent:t.slice(0,5)}}}static async searchByCategory(e){return this.search("",{category:e})}static async searchByLocation(e){return this.search("",{location:e})}static async getPopularCampaigns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t="popular:".concat(e),r=this.cache.get(t);if(r&&Date.now()-r.timestamp<this.CACHE_DURATION)return r.data;try{let r=await fetch("".concat(this.baseUrl,"/api/hub/campaigns/popular?limit=").concat(e));if(!r.ok)throw Error("Erreur campagnes populaires: ".concat(r.status));let n=await r.json();return this.cache.set(t,{data:n,timestamp:Date.now()}),n}catch(e){return console.error("Erreur lors du chargement des campagnes populaires:",e),[]}}static clearCache(){this.cache.clear()}static cleanExpiredCache(){let e=Date.now();for(let[t,{timestamp:r}]of this.cache.entries())e-r>this.CACHE_DURATION&&this.cache.delete(t)}}function x(e){let{placeholder:t="Rechercher une association, une campagne...",onSearch:r,onClear:x,defaultValue:b="",searchType:y="all",onSearchTypeChange:v,showTypeSelector:w=!0,showVoiceSearch:N=!1,size:j,autoFocus:C,showHistory:S,initialQuery:E}=e,[R,k]=(0,a.useState)(b),[D,A]=(0,a.useState)(w),[I,z]=(0,a.useState)({suggestions:[],recent:[]}),[U,F]=(0,a.useState)(!1),[O,H]=(0,a.useState)(-1),[_,T]=(0,a.useState)(!1),L=(0,a.useRef)(null),Z=(0,a.useRef)(null),{addSearchToHistory:B,getRecentSuggestions:J}=function(){let[e,t]=(0,a.useState)([]);return(0,a.useEffect)(()=>{try{let e=localStorage.getItem(f);if(e){let r=JSON.parse(e);t(r)}}catch(e){console.error("Erreur lors du chargement de l'historique de recherche:",e)}},[]),{history:e,addSearchToHistory:function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general",a=arguments.length>2?arguments[2]:void 0;if(!r.trim())return;let s=[{id:Date.now().toString(),text:r.trim(),timestamp:Date.now(),type:n,resultCount:a},...e.filter(e=>e.text.toLowerCase()!==r.toLowerCase())].slice(0,10);t(s),localStorage.setItem(f,JSON.stringify(s))},removeSearchFromHistory:r=>{let n=e.filter(e=>e.id!==r);t(n),localStorage.setItem(f,JSON.stringify(n))},clearSearchHistory:()=>{t([]),localStorage.removeItem(f)},getRecentSuggestions:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return e.slice(0,t).sort((e,t)=>t.timestamp-e.timestamp)}}}();(0,a.useEffect)(()=>{R.trim().length>0?M(R):z({suggestions:[],recent:J(5)})},[R]);let M=async e=>{F(!0);try{let t=J(5),r=await p.getAutocompleteSuggestions(e,t);z(r)}catch(e){console.error("Erreur lors du chargement des suggestions:",e)}finally{F(!1)}},q=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,n=e.trim();if(n){var a;B(n,"all"===t?"general":t),null==r||r(n,t),H(-1),null===(a=L.current)||void 0===a||a.blur()}},[R,y,r,B]),P=(e,t)=>{k(e),q(e,t||y)};return(0,a.useEffect)(()=>{let e=e=>{Z.current&&!Z.current.contains(e.target)&&L.current&&!L.current.contains(e.target)&&H(-1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),[...I.recent.map((e,t)=>({...e,isRecent:!0,index:t})),...I.suggestions.map((e,t)=>({...e,isRecent:!1,index:t+I.recent.length}))],(0,n.jsxs)("div",{className:"relative w-full max-w-2xl",ref:Z,children:[D&&(0,n.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>A(!D),className:"text-xs px-2 py-1",children:["all"===y?"Tout":"association"===y?"Associations":"Campagnes",(0,n.jsx)(s.Z,{className:"ml-1 h-3 w-3"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(h.I,{ref:L,type:"text",placeholder:t,value:R,onChange:e=>{k(e.target.value),H(-1)},onKeyDown:e=>{let t=[...I.recent.map(e=>({text:e.text,type:e.type})),...I.suggestions.map(e=>({text:e.text,type:e.type}))];if("Enter"===e.key)O>=0&&t[O]?P(t[O].text):q();else if("ArrowDown"===e.key)e.preventDefault(),H(e=>e<t.length-1?e+1:e);else if("ArrowUp"===e.key)e.preventDefault(),H(e=>e>0?e-1:-1);else if("Escape"===e.key){var r;H(-1),null===(r=L.current)||void 0===r||r.blur()}},onFocus:()=>{R.trim()||I.recent.length},autoFocus:C,className:"pl-12 pr-32 h-12 text-base"}),(0,n.jsx)(o.Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,n.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[N&&(0,n.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>{if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){console.warn("Reconnaissance vocale non support\xe9e");return}T(!0);let e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.continuous=!1,e.interimResults=!1,e.lang="fr-FR",e.onresult=e=>{let t=e.results[0][0].transcript;k(t),q(t)},e.onerror=e=>{console.error("Erreur reconnaissance vocale:",e.error),T(!1)},e.onend=()=>{T(!1)},e.start()},disabled:!("webkitSpeechRecognition"in window||"SpeechRecognition"in window),className:"absolute right-16 top-1/2 transform -translate-y-1/2 h-8 px-2 ".concat(_?"text-red-500 animate-pulse":"text-gray-400"),children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})}),R&&(0,n.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>{var e;k(""),H(-1),null==x||x(),null===(e=L.current)||void 0===e||e.focus()},className:"h-8 w-8 p-1 text-gray-400 hover:text-gray-600",children:(0,n.jsx)(c.Z,{className:"h-4 w-4"})}),(0,n.jsx)(d.z,{onClick:()=>q(),disabled:!R.trim()||U,className:"h-8 px-3",size:"sm",children:U?(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Rechercher"})]})]}),(0,n.jsx)(u.M,{children:(R.trim()||I.recent.length>0)&&(0,n.jsxs)(g.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-80 overflow-auto",children:[I.recent.length>0&&(0,n.jsxs)("div",{className:"border-b border-gray-100",children:[(0,n.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Recherches r\xe9centes"}),I.recent.map((e,t)=>(0,n.jsxs)("button",{onClick:()=>P(e.text),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center gap-3 ".concat(O===t?"bg-blue-50":""),children:[(0,n.jsx)(l.Z,{className:"w-4 h-4 text-gray-400"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.text}),e.resultCount&&(0,n.jsx)(m.C,{variant:"outline",className:"ml-auto text-xs",children:e.resultCount})]},"recent-".concat(t)))]}),I.suggestions.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Suggestions"}),I.suggestions.map((e,t)=>{let r=t+I.recent.length;return(0,n.jsxs)("button",{onClick:()=>P(e.text,e.type),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center gap-3 ".concat(O===r?"bg-blue-50":""),children:[(0,n.jsx)(o.Z,{className:"w-4 h-4 text-gray-400"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.text}),(0,n.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,n.jsx)(m.C,{variant:"campaign"===e.type?"accent":"outline",className:"text-xs",children:"association"===e.type?"Assoc":"Camp"}),e.count&&(0,n.jsx)(m.C,{variant:"outline",className:"text-xs",children:e.count})]})]},"suggestion-".concat(t))})]})]})})]})}p.baseUrl="http://localhost:3000",p.cache=new Map,p.CACHE_DURATION=3e5,setInterval(()=>{p.cleanExpiredCache()},6e5)},9174:function(e,t,r){r.d(t,{C:function(){return i}});var n=r(7437);r(2265);var a=r(535),s=r(3448);let o=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",accent:"border-transparent bg-accent-100 text-accent-700 hover:bg-accent-200",success:"border-transparent bg-green-100 text-green-700 hover:bg-green-200",warning:"border-transparent bg-orange-100 text-orange-700 hover:bg-orange-200",destructive:"border-transparent bg-red-100 text-red-700 hover:bg-red-200",outline:"text-foreground border-border",verified:"border-transparent bg-green-500 text-white"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...a}=e;return(0,n.jsx)("div",{className:(0,s.cn)(o({variant:r}),t),...a})}},2381:function(e,t,r){r.d(t,{z:function(){return c}});var n=r(7437),a=r(2265),s=r(535),o=r(3448);let i=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-primary-600 text-white hover:bg-primary-700 active:bg-primary-800",secondary:"bg-white text-gray-900 border border-gray-300 hover:bg-gray-50 active:bg-gray-100",accent:"bg-accent-600 text-white hover:bg-accent-700 active:bg-accent-800",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",destructive:"bg-red-500 text-white hover:bg-red-600 active:bg-red-700"},size:{sm:"h-9 px-3 text-xs",default:"h-10 px-4 py-2",lg:"h-11 px-8",xl:"h-12 px-10 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,asChild:c=!1,loading:l=!1,children:u,disabled:g,...h}=e;return(0,n.jsxs)("button",{className:(0,o.cn)(i({variant:a,size:s,className:r})),ref:t,disabled:g||l,...h,children:[l&&(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),u]})});c.displayName="Button"},279:function(e,t,r){r.d(t,{I:function(){return o}});var n=r(7437),a=r(2265),s=r(3448);let o=a.forwardRef((e,t)=>{let{className:r,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},3448:function(e,t,r){r.d(t,{SB:function(){return u},aF:function(){return c},cn:function(){return s},p6:function(){return l},uf:function(){return i},xG:function(){return o}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"EUR";return new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(e)}function i(e){return new Intl.NumberFormat("fr-FR").format(e)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return e.length<=t?e:e.slice(0,t)+"..."}function l(e){return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"long",day:"numeric"}).format(new Date(e))}function u(e,t){return 0===t?0:Math.min(e/t*100,100)}}}]);