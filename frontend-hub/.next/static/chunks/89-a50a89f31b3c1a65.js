"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[89],{89:function(e,t,r){r.d(t,{E:function(){return p}});var n=r(7437),a=r(2265),s=r(3247),o=r(1239),i=r(2489),c=r(1723),l=r(8614),u=r(9653),g=r(279),h=r(2381),d=r(9174);let m="hub-search-history";class f{static async search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n="search:".concat(e,":").concat(JSON.stringify(t),":").concat(JSON.stringify(r)),a=this.cache.get(n);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;try{let a=new URLSearchParams({q:e,page:String(r.page||1),limit:String(r.limit||20),sort:r.sort||"relevance"});Object.entries(t).forEach(e=>{let[t,r]=e;null!=r&&""!==r&&a.append(t,String(r))});let s=await fetch("".concat(this.baseUrl,"/api/search?").concat(a)),o=await s.json();return this.cache.set(n,{data:o,timestamp:Date.now()}),o}catch(e){return console.error("Erreur lors de la recherche:",e),{associations:[],campaigns:[],total:0}}}static async getAutocompleteSuggestions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e.trim())return{suggestions:[],recent:t.map(e=>({text:e.text,type:e.type,resultCount:0})).slice(0,5)};let r="autocomplete:".concat(e),n=this.cache.get(r);if(n&&Date.now()-n.timestamp<this.CACHE_DURATION)return{...n.data,recent:t.map(e=>({text:e.text,type:e.type,resultCount:0})).slice(0,5)};try{let n=new URLSearchParams({q:e,limit:"8"}),a=await fetch("".concat(this.baseUrl,"/api/hub/autocomplete?").concat(n));if(!a.ok)throw Error("Erreur autocompl\xe9tion: ".concat(a.status));let s={suggestions:(await a.json()).slice(0,6),recent:t.map(e=>({text:e.text,type:e.type,resultCount:0})).slice(0,5)};return this.cache.set(r,{data:{suggestions:s.suggestions,recent:[]},timestamp:Date.now()}),s}catch(e){return console.error("Erreur lors de l'autocompl\xe9tion:",e),{suggestions:[],recent:t.map(e=>({text:e.text,type:e.type,resultCount:0})).slice(0,5)}}}static async searchByCategory(e){return this.search("",{category:e})}static async searchByLocation(e){return this.search("",{location:e})}static async getPopularCampaigns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t="popular:".concat(e),r=this.cache.get(t);if(r&&Date.now()-r.timestamp<this.CACHE_DURATION)return r.data;try{let r=await fetch("".concat(this.baseUrl,"/api/hub/campaigns/popular?limit=").concat(e));if(!r.ok)throw Error("Erreur campagnes populaires: ".concat(r.status));let n=await r.json();return this.cache.set(t,{data:n,timestamp:Date.now()}),n}catch(e){return console.error("Erreur lors du chargement des campagnes populaires:",e),[]}}static clearCache(){this.cache.clear()}static cleanExpiredCache(){let e=Date.now();for(let[t,{timestamp:r}]of this.cache.entries())e-r>this.CACHE_DURATION&&this.cache.delete(t)}}function p(e){let{onSearch:t,placeholder:r="Rechercher une association, une campagne...",className:p}=e,[x,b]=(0,a.useState)(""),[y,v]=(0,a.useState)({suggestions:[],recent:[]}),[w,N]=(0,a.useState)(!1),[C,j]=(0,a.useState)(-1),[S,E]=(0,a.useState)(!1),[k,R]=(0,a.useState)(!1),D=(0,a.useRef)(null),A=(0,a.useRef)(null),{addSearchToHistory:I,getRecentSuggestions:U}=function(){let[e,t]=(0,a.useState)([]);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(m);if(e){let r=JSON.parse(e);t(r)}}catch(e){console.error("Erreur lors du chargement de l'historique de recherche:",e)}},[]);let r=(0,a.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return e.slice(0,t).sort((e,t)=>t.timestamp-e.timestamp)},[e]);return{history:e,addSearchToHistory:function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general",a=arguments.length>2?arguments[2]:void 0;if(!r.trim())return;let s=[{id:Date.now().toString(),text:r.trim(),timestamp:Date.now(),type:n,resultCount:a},...e.filter(e=>e.text.toLowerCase()!==r.toLowerCase())].slice(0,10);t(s),localStorage.setItem(m,JSON.stringify(s))},removeSearchFromHistory:r=>{let n=e.filter(e=>e.id!==r);t(n),localStorage.setItem(m,JSON.stringify(n))},clearSearchHistory:()=>{t([]),localStorage.removeItem(m)},getRecentSuggestions:r}}(),z=(0,a.useCallback)(async e=>{N(!0);try{let t=U(5),r=await f.getAutocompleteSuggestions(e,t);v(r)}catch(e){console.error("Erreur lors du chargement des suggestions:",e)}finally{N(!1)}},[U]);(0,a.useEffect)(()=>{let e=setTimeout(()=>{x?z(x):v({suggestions:[],recent:U(5)})},300);return()=>clearTimeout(e)},[x,z,U]);let O=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,r=e.trim();if(r){var n;I(r),null==t||t(r),j(-1),null===(n=D.current)||void 0===n||n.blur()}},[x,t,I]),F=e=>{b(e),O(e)};return(0,a.useEffect)(()=>{R("webkitSpeechRecognition"in window||"SpeechRecognition"in window)},[]),(0,a.useEffect)(()=>{let e=e=>{A.current&&!A.current.contains(e.target)&&D.current&&!D.current.contains(e.target)&&j(-1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,n.jsxs)("div",{className:"relative w-full max-w-2xl ".concat(p),ref:A,children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(g.I,{ref:D,type:"text",placeholder:r,value:x,onChange:e=>{b(e.target.value),j(-1)},onKeyDown:e=>{let t=[...y.recent.map(e=>({text:e.text})),...y.suggestions.map(e=>({text:e.text}))];if("Enter"===e.key)C>=0&&t[C]?F(t[C].text):O();else if("ArrowDown"===e.key)e.preventDefault(),j(e=>e<t.length-1?e+1:e);else if("ArrowUp"===e.key)e.preventDefault(),j(e=>e>0?e-1:-1);else if("Escape"===e.key){var r;j(-1),null===(r=D.current)||void 0===r||r.blur()}},className:"pl-12 pr-32 h-12 text-base"}),(0,n.jsx)(s.Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,n.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[(0,n.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>{if(!k){console.warn("Reconnaissance vocale non support\xe9e");return}E(!0);let e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.continuous=!1,e.interimResults=!1,e.lang="fr-FR",e.onresult=e=>{let t=e.results[0][0].transcript;b(t),O(t),E(!1)},e.onerror=e=>{console.error("Erreur reconnaissance vocale:",e.error),E(!1)},e.onend=()=>{E(!1)},e.start()},disabled:!k,className:"absolute right-16 top-1/2 transform -translate-y-1/2 h-8 px-2 ".concat(S?"text-red-500 animate-pulse":"text-gray-400"),children:(0,n.jsx)(o.Z,{className:"h-4 w-4"})}),x&&(0,n.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>{var e;b(""),j(-1),null===(e=D.current)||void 0===e||e.focus()},className:"h-8 w-8 p-1 text-gray-400 hover:text-gray-600",children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})}),(0,n.jsx)(h.z,{onClick:()=>O(),disabled:!x.trim()||w,className:"h-8 px-3",size:"sm",children:w?(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Rechercher"})]})]}),(0,n.jsx)(l.M,{children:(x.trim()||y.recent.length>0)&&(0,n.jsxs)(u.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-80 overflow-auto",children:[y.recent.length>0&&(0,n.jsxs)("div",{className:"border-b border-gray-100",children:[(0,n.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Recherches r\xe9centes"}),y.recent.map((e,t)=>(0,n.jsxs)("button",{onClick:()=>F(e.text),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center gap-3 ".concat(C===t?"bg-blue-50":""),children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 text-gray-400"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.text}),e.resultCount&&(0,n.jsx)(d.C,{variant:"outline",className:"ml-auto text-xs",children:e.resultCount})]},"recent-".concat(t)))]}),y.suggestions.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-gray-500 bg-gray-50",children:"Suggestions"}),y.suggestions.map((e,t)=>{let r=t+y.recent.length;return(0,n.jsxs)("button",{onClick:()=>F(e.text),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center gap-3 ".concat(C===r?"bg-blue-50":""),children:[(0,n.jsx)(s.Z,{className:"w-4 h-4 text-gray-400"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.text})]},"suggestion-".concat(t))})]})]})})]})}f.baseUrl="http://localhost:3000",f.cache=new Map,f.CACHE_DURATION=3e5,setInterval(()=>{f.cleanExpiredCache()},6e5)},9174:function(e,t,r){r.d(t,{C:function(){return i}});var n=r(7437);r(2265);var a=r(535),s=r(3448);let o=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",accent:"border-transparent bg-accent-100 text-accent-700 hover:bg-accent-200",success:"border-transparent bg-green-100 text-green-700 hover:bg-green-200",warning:"border-transparent bg-orange-100 text-orange-700 hover:bg-orange-200",destructive:"border-transparent bg-red-100 text-red-700 hover:bg-red-200",outline:"text-foreground border-border",verified:"border-transparent bg-green-500 text-white"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...a}=e;return(0,n.jsx)("div",{className:(0,s.cn)(o({variant:r}),t),...a})}},2381:function(e,t,r){r.d(t,{z:function(){return c}});var n=r(7437),a=r(2265),s=r(535),o=r(3448);let i=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-primary-600 text-white hover:bg-primary-700 active:bg-primary-800",secondary:"bg-white text-gray-900 border border-gray-300 hover:bg-gray-50 active:bg-gray-100",accent:"bg-accent-600 text-white hover:bg-accent-700 active:bg-accent-800",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",destructive:"bg-red-500 text-white hover:bg-red-600 active:bg-red-700"},size:{sm:"h-9 px-3 text-xs",default:"h-10 px-4 py-2",lg:"h-11 px-8",xl:"h-12 px-10 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,loading:c=!1,children:l,disabled:u,...g}=e;return(0,n.jsxs)("button",{className:(0,o.cn)(i({variant:a,size:s,className:r})),ref:t,disabled:u||c,...g,children:[c&&(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l]})});c.displayName="Button"},279:function(e,t,r){r.d(t,{I:function(){return o}});var n=r(7437),a=r(2265),s=r(3448);let o=a.forwardRef((e,t)=>{let{className:r,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},3448:function(e,t,r){r.d(t,{SB:function(){return u},aF:function(){return c},cn:function(){return s},p6:function(){return l},uf:function(){return i},xG:function(){return o}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"EUR";return new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(e)}function i(e){return new Intl.NumberFormat("fr-FR").format(e)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return e.length<=t?e:e.slice(0,t)+"..."}function l(e){return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"long",day:"numeric"}).format(new Date(e))}function u(e,t){return 0===t?0:Math.min(e/t*100,100)}}}]);